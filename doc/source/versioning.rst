Database Upgrade / Downgrade
================================

.. toctree::
   :maxdepth: 2

Initialize Alembic
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

#. create migration directory::

    > cd <project>
    > alembic init migration
    > mv alembic.ini .. # you'll be editing alembic.ini to include a password
                        # don't want that under source control

#. edit alembic.ini to point sqlalchemy.url at database URL
#. edit migration/env.py to point target_metadata at model's metadata

Generate Revision
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

#. create revision file::

    > cd <project>
    > alembic --config ../alembic.ini revision --autogenerate -m "add member column to runner table"

#. update revision file, e.g.::

    def upgrade():
        ### commands auto generated by Alembic - please adjust! ###
        op.add_column('runner', sa.Column('member', sa.Boolean(), nullable=True))
        ### end Alembic commands ###
        
        # on upgrade, all runners are members
        runner = table('runner',
                       column('member',sa.Boolean())
                       )
        op.execute(runner.update().values({'member':op.inline_literal(True)}))

Run Upgrade
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

#. upgrade to latest::

    > cd <project>
    > alembic --config ../alembic.ini upgrade head

